function requestLiveData(){$.ajax({url:"ajax.php?a=live",dataType:"json",success:function(e){var t=$("#settingsOverlay").data("liveinterval");var n=6e4/t;var r=chart.series[0],i=r.data.length>n;var s=(new Date).getTime();var o=e["pwr"];chart.series[0].addPoint([s,o],true,i);if(tmpWatt<parseInt(e["pwr"])){updown="countUp"}else if(tmpWatt==parseInt(e["pwr"])){updown=""}else{updown="countDown"}tmpWatt=parseInt(e["pwr"]);$("#wattCounter").html("<span class='"+updown+"'>"+e["pwr"]+" Watt</span>");setTimeout(requestLiveData,t)},cache:false})}function calculate(e,t){$("#kwhCounter").html("<span style='line-height:30px;font-style:italic;'>Loading…</span>");$("#cpkwhCounter").html("<span style='line-height:30px;font-style:italic;'>Loading…</span>");$.ajax({url:"ajax.php?a=calculate_"+e+"&date="+t,dataType:"json",success:function(e){if($("input[name=dualcount]:checked").val()==1){$("#kwhCounter").html("<span>H: "+e["kwh"]+" kWh<br>L: "+e["kwhLow"]+" kWh<br>T: "+e["totalKwh"]+" kWh</span>");$("#cpkwhCounter").html("<span>H: € "+e["price"]+" <br>L: € "+e["priceLow"]+" <br>T: € "+e["totalPrice"]+"</span>")}else{$("#kwhCounter").html("<span style='line-height:30px;'>"+e["kwh"]+" kWh</span>");$("#cpkwhCounter").html("<span style='line-height:30px;'>€ "+e["price"]+"</span>")}},cache:false})}function createChart(e,t){if(loadingEnabled){historychart.showLoading()}else{loadingEnabled=true}$.ajax({url:"ajax.php?a="+e+"&date="+t,dataType:"json",success:function(n){if(n["ok"]==0){$("#message").text(n["msg"]);$("#overlay").fadeIn()}jsDate=n["start"].split("-");year=jsDate[0];month=jsDate[1]-1;day=jsDate[2]-0;var r=(new Date(year,month,day)).getTime();if(e=="week"){var i="Weekverbruik";var s="areaspline";var o="Watt";var u={text:"Watt",margin:40};var a=true;var f=true;var l=60*1e3;var c=null;var h=[{value:r+24*60*60*1e3,width:1,color:"#c0c0c0"},{value:r+2*24*60*60*1e3,width:1,color:"#c0c0c0"},{value:r+3*24*60*60*1e3,width:1,color:"#c0c0c0"},{value:r+4*24*60*60*1e3,width:1,color:"#c0c0c0"},{value:r+5*24*60*60*1e3,width:1,color:"#c0c0c0"},{value:r+6*24*60*60*1e3,width:1,color:"#c0c0c0"}];var p=[{type:"hour",count:1,text:"1u"},{type:"hour",count:12,text:"12u"},{type:"day",count:1,text:"dag"},{type:"week",count:1,text:"week"}]}else if(e=="day"){var i="Dagverbruik";var s="areaspline";var o="Watt";var u={text:"Watt",margin:40};var a=false;var f=true;var l=60*1e3;var c=null;var h=null;var p=[{type:"hour",count:1,text:"1u"},{type:"hour",count:12,text:"12u"},{type:"day",count:1,text:"dag"}]}else if(e=="month"){var i="Maandverbruik";var s="column";var o="kWh";var u={text:"Kilowattuur",margin:40};var a=false;var f=false;var l=24*60*60*1e3;var c=48*60*60*1e3;var h=null;var p=[]}data=n["val"].split(",");for(var d=0;d<data.length;d++){data[d]=parseFloat(data[d],10)}historychart=new Highcharts.StockChart({chart:{renderTo:"history",type:s},rangeSelector:{buttons:p},credits:{enabled:false},title:{text:i},yAxis:{showFirstLabel:false,title:u},xAxis:{type:"datetime",tickInterval:c,plotLines:h},rangeSelector:{enabled:a},navigator:{enabled:f},scrollbar:{enabled:f},series:[{name:o,turboThreshold:5e3,data:data,pointStart:r,pointInterval:l,tooltip:{valueDecimals:2}}]});calculate(e,t)},cache:false})}var loadingEnabled=false;var tmpWatt=0;$(document).ready(function(){$("#closeDialog").click(function(){$("#overlay").hide()});$("#showSettings").click(function(){$("#settingsOverlay").slideDown()});$("#hideSettings").click(function(){$("#settingsOverlay").slideUp(function(){var e=$("input[name=dualcount]:checked").val();if(e!=$("#settingsOverlay").data("dualcount")){$("input[name=dualcount]").not(":checked").attr("checked",true);if($("#settingsOverlay").data("dualcount")==1){$(".cpkwhlow").show()}else{$(".cpkwhlow").hide()}}})});$("input[name=dualcount]").change(function(){var e=$("input[name=dualcount]:checked").val();if(e==1){$(".cpkwhlow").show()}else{$(".cpkwhlow").hide()}});$("#saveSettings").click(function(){$.ajax({url:"ajax.php?a=saveSettings",type:"POST",dataType:"json",data:$("#settingsOverlay form").serialize(),success:function(e){$("#settingsOverlay").slideUp("fast",function(){$("#settingsOverlay input[type=password]").val("")});if($("#settingsOverlay").data("dualcount")!=$("input[name=dualcount]:checked").val()){$("#settingsOverlay").data("dualcount",$("input[name=dualcount]:checked").val());var t=$("#history").data("chart");calculate(t,$("#datepicker").val())}$("#settingsOverlay").data("liveinterval",$("select[name=liveinterval]").val());$("#message").text(e["msg"]);$("#overlay").fadeIn()}});return false});$(".showChart").click(function(){var e=$(this).data("chart");$(".chart").hide();$("."+e).show();$(".btn li").each(function(){$(this).removeClass("selected")});$(this).parent().addClass("selected");$("#history").data("chart",e);if(e!="live"){createChart(e,$("#datepicker").val())}});Highcharts.setOptions({global:{useUTC:false},lang:{decimalPoint:",",months:["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"],shortMonths:["Jan","Feb","Mrt","Apr","Mei","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],weekdays:["Zondag","Maandag","Dinsdag","Woensdag","Donderdag","Vrijdag","Zaterdag"]}});chart=new Highcharts.Chart({chart:{renderTo:"live",defaultSeriesType:"areaspline",events:{load:requestLiveData}},credits:{enabled:false},legend:{enabled:false},title:{text:"Actueel verbruik"},xAxis:{type:"datetime",tickPixelInterval:150,minRange:60*1e3},yAxis:{showFirstLabel:false,minPadding:.2,maxPadding:.2,title:{text:"Watt",margin:40}},series:[{name:"Watt",data:[]}],exporting:{enabled:false}});$("#datepicker").datepicker({inline:true,dateFormat:"yy-mm-dd",maxDate:new Date,showOn:"focus",firstDay:1,monthNames:["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"],monthNamesShort:["jan","feb","maa","apr","mei","jun","jul","aug","sep","okt","nov","dec"],dayNames:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],dayNamesShort:["zon","maa","din","woe","don","vri","zat"],dayNamesMin:["zo","ma","di","wo","do","vr","za"],onSelect:function(e,t){var n=$("#history").data("chart");createChart(n,e)}})})